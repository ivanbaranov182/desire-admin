(()=>{var e={997:e=>{const t=e=>void 0===e,n=e=>Array.isArray(e),r=e=>e&&"number"==typeof e.size&&"string"==typeof e.type&&"function"==typeof e.slice,o=(e,i,s,a)=>((i=i||{}).indices=!t(i.indices)&&i.indices,i.nullsAsUndefineds=!t(i.nullsAsUndefineds)&&i.nullsAsUndefineds,i.booleansAsIntegers=!t(i.booleansAsIntegers)&&i.booleansAsIntegers,i.allowEmptyArrays=!t(i.allowEmptyArrays)&&i.allowEmptyArrays,s=s||new FormData,t(e)||(null===e?i.nullsAsUndefineds||s.append(a,""):(e=>"boolean"==typeof e)(e)?i.booleansAsIntegers?s.append(a,e?1:0):s.append(a,e):n(e)?e.length?e.forEach(((e,t)=>{const n=a+"["+(i.indices?t:"")+"]";o(e,i,s,n)})):i.allowEmptyArrays&&s.append(a+"[]",""):(e=>e instanceof Date)(e)?s.append(a,e.toISOString()):!(e=>e===Object(e))(e)||(e=>r(e)&&"string"==typeof e.name&&("object"==typeof e.lastModifiedDate||"number"==typeof e.lastModified))(e)||r(e)?s.append(a,e):Object.keys(e).forEach((t=>{const r=e[t];if(n(r))for(;t.length>2&&t.lastIndexOf("[]")===t.length-2;)t=t.substring(0,t.length-2);o(r,i,s,a?a+"["+t+"]":t)}))),s);e.exports={serialize:o}}},t={};function n(r){var o=t[r];if(void 0!==o)return o.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}(()=>{"use strict";var e=function(){return new URL(document.URL).searchParams.has("debug")};function t(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}const r=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var n,r,o;return n=e,(r=[{key:"modifiedAt",get:function(){var e,t=document.querySelector('meta[property="article:modified_time"]');return t?(e=t.content,new Date(e).getTime()):0}},{key:"url",get:function(){return(e=document.querySelector('meta[property="og:url"]'))?e.content:"";var e}},{key:"urlFrom",get:function(){return document.referrer||""}},{key:"resolution",get:function(){return{screenWidth:document.documentElement.clientWidth,screenHeight:document.documentElement.clientHeight}}},{key:"getStatistic",value:function(){return{url:this.url,urlFrom:this.urlFrom,resolution:this.resolution,modifiedAt:this.modifiedAt}}}])&&t(n.prototype,r),o&&t(n,o),e}();var o=void 0,i="0px",s=0;function a(e,t){for(var n=Object.getOwnPropertyNames(e),r=0,o=n.length;r<o;r+=1){var i=n[r];t(e[i],i)}}const c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1?arguments[1]:void 0,n=o,r=t;if(!window.IntersectionObserver)throw new Error("There is no native support for IntersectionObserver API in your browser. Please, use polyfill");var c={rootMargin:e.rootMargin||i,threshold:e.threshold||s},u=function(e){for(var t=0,n=e.length;t<n;t+=1){var o=e[t],i=o.intersectionRatio,s=o.target,a=s.classList;i>0?a.contains("in-viewport-".concat(r))?(a.remove("in-viewport-".concat(r)),v("leave",s)):(a.add("in-viewport-".concat(r)),v("enter",s)):a.contains("in-viewport-".concat(r))&&(a.remove("in-viewport-".concat(r)),v("leave",s))}},l=new IntersectionObserver(u,c),f={enter:[],leave:[]};function v(e,t){var n=f[e],r=n.findIndex((function(e){return e.target===t}));r>-1&&n[r].trigger()}return{getObserver:function(){return l},observe:function(e){if(!e)throw new Error("Target element is not set for observe function");return l.observe(e),n},on:function(e,t,r){if(!Array.isArray(f[e]))throw new Error("viewportObserver: method `on` get not correct event type");return f[e].push({target:t,trigger:r}),n},off:function(e,t){if(!Array.isArray(f[e]))throw new Error("viewportObserver: method `off` get not correct event type");var r=f[e].findIndex((function(e){return e.target===t}));return r>-1&&f[e].splice(r,1),n},unobserve:function(e){if(!e)throw new Error("Target element is not set for unobserve function");l.unobserve(e),a(f,(function(t,n){var r=f[n].findIndex(e);r>-1&&f[n].splice(r,1)}))},unobserveAll:function(){l.disconnect(),a(f,(function(e,t){f[t].length=0}))}}};var u=function(e,t){var n,r,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"0px",i=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,a=.5,u=0,l=!1,f={rootMargin:o,threshold:i},v={rootMargin:t},p=c(f,"start"),d=c(v,"end");function b(){l=!0,n=setInterval((function(){return u+=a}),1e3*a),p.unobserveAll(),d.on("enter",e,m),d.on("leave",e,g),s&&(r=setTimeout(h,s-u))}function m(){}function g(){l=!1,d.unobserveAll(),clearInterval(n)}function h(){p.unobserveAll(),d.unobserveAll(),clearInterval(n),clearTimeout(r)}return p.observe(e),p.on("enter",e,b),d.observe(e),{time:u,getTime:function(){return u},target:e,stopObserveAll:h,isVisible:function(){return l}}};function l(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function f(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?l(Object(n),!0).forEach((function(t){p(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function v(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var d=e();const b=function(){function e(t,n,r){var o=this;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),p(this,"addEvents",(function(){window.addEventListener("blur",o.stopObserveAll.bind(o)),o.idleChecker=function(e,t){var n;function r(){clearTimeout(n),n=setTimeout(t,e)}return window.onload=r,window.onmousemove=r,window.onmousedown=r,window.ontouchstart=r,window.onclick=r,window.onkeypress=r,window.addEventListener("scroll",r,!0),{stop:function(){clearTimeout(n)}}}(1e4,o.stopObserveAll.bind(o)),o.timeToVIew&&o.observeItems.forEach((function(e){e.observer.target.addEventListener("click",(function(e){e.preventDefault(),console.log("click"),alert()}))}))})),p(this,"removeEvents",(function(){o.idleChecker.stop(),window.removeEventListener("blur",o.stopObserveAll.bind(o)),o.observeItems.forEach((function(e){}))})),this.items=t,this.onStop=n,this.timeToVIew=r,this.statistic=t.reduce((function(e,t){return f(f({},e),{},p({},t.name,t.name in e?[]:0))}),{}),this.observeItems=[],this.items.forEach(this.addToObserve.bind(this)),this.addEvents()}var t,n,r;return t=e,(n=[{key:"handleClick",value:function(e){this.stopObserveAll(e.name),this.removeEvents()}},{key:"stopObserveAll",value:function(e){this.observeItems.forEach((function(e){return e.observer.stopObserveAll()})),d&&console.log("stop timers");var t=this.observeItems.filter((function(e){return e.observer.isVisible()})).map((function(e){return e.name}));this.onStop&&this.onStop(t,e)}},{key:"addToObserve",value:function(e){var t=e.name,n=e.target,r=e.observerOptions,o=r.endRootMargin,i=r.startRootMargin,s=r.threshold;n&&this.observeItems.push({name:t,observer:u(n,o,i,s,this.timeToVIew)})}},{key:"clearStatistic",value:function(){var e=this;this.observeItems.forEach((function(t){var n=t.name,r=t.observer.target;Array.isArray(e.statistic[n])&&"IMG"===r.tagName?e.statistic[n]=[]:e.statistic[n]=0}))}},{key:"getStatistic",value:function(){var e=this;return this.clearStatistic(),this.observeItems.forEach((function(t){var n=t.name,r=t.observer,o=r.target,i=r.getTime;Array.isArray(e.statistic[n])&&"IMG"===o.tagName?e.statistic[n].push({src:[o.getAttribute("src")],time:i()}):e.statistic[n]=i()})),this.statistic}}])&&v(t.prototype,n),r&&v(t,r),e}();var m=n(997);function g(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h,y,w,O="http://core.desire.r-admin.ru/metrika/trace",A=O,j=function(){var e=function(e){return"".concat(A).concat(e)};return{sendArticleStatistic:function(t){!function(t,n){navigator.sendBeacon(e(t),(0,m.serialize)(n))}("/article-statistics",t)}}};function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){I(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function k(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function I(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}h=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"getApiUrl",value:function(e){return"".concat(A).concat(e)}},{key:"get",value:function(t,n){var r=Object.keys(n).map((function(e){return e+"="+n[e]})).join("&");return fetch(e.getApiUrl("".concat(t,"?").concat(r))).then((function(e){return e.json()}))}},{key:"getRecommendations",value:function(t,n,r){var o={user:t,domain:n,slug:r};return e.get("/recommendations",o)}}],(n=null)&&g(t.prototype,n),r&&g(t,r),e}(),y="canBeacon",w=!!navigator.sendBeacon,y in h?Object.defineProperty(h,y,{value:w,enumerable:!0,configurable:!0,writable:!0}):h[y]=w;const x=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),I(this,"wasStop",!1),this.items=this.getItems(),this.dataAnalytics=new r,this.timeAnalytics=new b(this.items,this.onStop.bind(this)),this.get=this.getStatisticData.bind(this)}var t,n,o;return t=e,(n=[{key:"getItems",value:function(){return e=[{name:"title",target:document.querySelector("article h1"),observerOptions:{endRootMargin:"-19% 0px -80% 0px"}},{name:"mainImage",target:document.querySelector("article img"),observerOptions:{endRootMargin:"-59% 0px -40% 0px"}},{name:"preview",target:document.querySelector("article .preview"),observerOptions:{endRootMargin:"-59% 0px -40% 0px"}},{name:"text",target:document.querySelector("article .full-text"),observerOptions:{endRootMargin:"-59% 0px -40% 0px"}},{name:"content",target:document.querySelector("article.post"),observerOptions:{endRootMargin:"-59% 0px -40% 0px"}},{name:"page",target:document.querySelector("body"),observerOptions:{endRootMargin:"0px"}}],document.querySelectorAll(".full-text img").forEach((function(t){return e.push({name:"images",target:t,observerOptions:{threshold:.8,endRootMargin:"-79% 0px -20% 0px"}})})),e;var e}},{key:"onStop",value:function(){if(!this.wasStop){var e=this.getStatisticData();this.wasStop=!0,console.log("statistic",e),j().sendArticleStatistic(e)}}},{key:"getStatisticData",value:function(){return S(S({},this.dataAnalytics.getStatistic()),this.timeAnalytics.getStatistic())}}])&&k(t.prototype,n),o&&k(t,o),e}();e();new x})()})();